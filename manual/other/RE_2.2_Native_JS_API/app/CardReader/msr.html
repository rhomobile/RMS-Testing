<html>
<head>
<script type="text/javascript" src="/public/re1/elements.js"></script>

    <title>NEON CardReader Test</title>
<META HTTP-Equiv="ZoomTextButton" Content="Visibility:Visible">

<meta name="mobileoptimized" content="0" />
 </head>
<body>
<br /><br /><br />
<div id="Message">Message</div>
<br /><br />
<form id="frmCardReader" action="">
CardReader using JSObjects
<hr>


Module:<br />
<input type="radio" name="group1" value="MSR7000" />MSR7000
<input type="radio" name="group1" value="DCR7000" />DCR7000
<input type="radio" name="group1" value="MSR9500" />MSR9500
<input type="radio" name="group1" value="MSR9000" />MSR9000
<input type="radio" name="group1" value="MSR55" />MSR55
<input type="radio" name="group1" value="MSR3000" />MSR3000
<input type="radio" name="group1" value="" />EMPTY
<input type="radio" name="group1" value="DEFAULT" checked="checked" />DEFAULT



<hr />

Event:<br />
<input type="radio" name="group2" value="JavaScript" checked="checked" />JavaScript
<input type="radio" name="group2" value="JSON" />JSON
<input type="radio" name="group2" value="HTML" />HTML
<input type="radio" name="group2" value="DETACHEVENT" />DETACHEVENT
<input type="radio" name="group2" value="EMPTYEVENT" />EMPTYEVENT
<hr />
<table>
<tr>
    <td><input type="button" id="Button2" onclick="SetPANData();" value="SetPANData"/></td>

    <td><input type="button" id="cmdOpen" onclick="OpenMSR();" value="Open MSR"/></td>

    <td><input type="button" id="Button1" onclick="attachRead();" value="Attach ReadEvent"/></td>
</tr>
</table>

<table border=1 width=100%>
    <tr>

        <td><a href="main"></a></td>
    </tr>

    <tr>
        <td>Encryption:</td><td><Textarea id="txtEncData" cols="50" rows="1"></Textarea></td>

    </tr>
	    <tr>
        <td>Card Data:</td><td><Textarea id="txtCardData" cols="50" rows="10"></Textarea></td>
    </tr>
    <tr>
        <td>RawData:</td><td><Textarea id="txtRawData" cols="50" rows="12"></Textarea></td>
    </tr>
    <tr>
        <td>Track1 Data:</td><td><Textarea id="txtTrack1Data" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track2 Data:</td><td><Textarea id="txtTrack2Data" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track3 Data:</td><td><Textarea id="txtTrack3Data" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track1 Status:</td><td><Textarea id="txtTrack1Status" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>Track2 Status:</td><td><Textarea id="txtTrack2Status" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>Track3 Status:</td><td><Textarea id="txtTrack3Status" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>Track1 Encdata:</td><td><Textarea id="txtTrack1EnceData" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track2 Encdata:</td><td><Textarea id="txtTrack2EnceData" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track3 Encdata:</td><td><Textarea id="txtTrack3EnceData" cols="50" rows="3"></Textarea></td>
    </tr>
	    <tr>
        <td>Track1 EncStatus:</td><td><Textarea id="txtTrack1EncStatus" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>Track2 EncStatus:</td><td><Textarea id="txtTrack2EncStatus" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>Track3 EncStatus:</td><td><Textarea id="txtTrack3EncStatus" cols="6" rows="1"></Textarea></td>
    </tr>
	    <tr>
        <td>KSN:</td><td><Textarea id="txtTKSNData" cols="50" rows="1"></Textarea></td>
    </tr>
	
</table>


<table>

    <tr>
        <td>PinTimeOut:</td>
        <td><textarea id="txt1" cols="10" rows="1">DEFAULT</textarea></td>
    </tr>
    <tr>
        <td>PAN:</td><td><textarea id="Textarea1" cols="20" rows="1">1111222233334444</textarea></td>
    </tr>

</table>


<table>

<tr>
<td><a name="settings"></a></td>
</tr>

<tr>
<td>AutoEnter:</td>
<td colspan=2>
<input type="radio" name="group3" value="DEFAULT" checked="checked" />DEFAULT
<input type="radio" name="group3" value="disabled" />Disabled
<input type="radio" name="group3" value="enabled" />Enabled
<input type="radio" name="group3" value="INVALIDSTRING" />INVALIDSTRING
<input type="radio" name="group3" value="" />EMPTYSTRING
</td>
</tr>
<tr>
<td>AutoTab</td>
<td colspan=2>

<input type="radio" name="group4" value="DEFAULT" checked="checked" />DEFAULT
<input type="radio" name="group4" value="disabled" />Disabled
<input type="radio" name="group4" value="enabled" />Enabled
<input type="radio" name="group4" value="INVALIDSTRING" />INVALIDSTRING
<input type="radio" name="group4" value="" />EMPTYSTRING
</td>
</tr>
<tr>
<td>PinEnt</td>
<td colspan=2>

<input type="radio" name="group5" value="DEFAULT" checked="checked" />DEFAULT
<input type="radio" name="group5" value="Off" />Off
<input type="radio" name="group5" value="On" />On
<input type="radio" name="group5" value="INVALIDSTRING" />INVALIDSTRING
<input type="radio" name="group5" value="" />EMPTYSTRING
</td>
</tr>
<tr>
<td><br /><input type="button" id="Button2" ONCLICK="CloseMSR();" value="Close"/></td>
</tr>
</table>

</form>
<P><INPUT TYPE="button" VALUE="Back" ONCLICK="location.href='CardReader_Index.html'"></P>
</body>
</html>

<script language=javascript type="text/javascript">


//var generic = new ActiveXObject("PocketBrowser.Generic");
var SelectedItem="";
var SelectedMSR="";

function attachRead()
{   
    SelectAppropriateMSR();
    SetAutoEnter();
    SetAutoTab();
    SetPinEntry();
    SetPinTimeout();
    
    for (var i=0; i < frmCardReader.group2.length; i++)
   	{   
     	if (frmCardReader.group2[i].checked)
      		{
      		    
      		SelectedItem= frmCardReader.group2[i].value;
      			
      	}
   	}	
  
    
    var temp;
    alert(SelectedItem);
    if (SelectedItem == "HTML")
     {
      temp = "readevent:url('http://10.233.85.82/NEON/Navigate.html?Data=%s&MODE=%s&encryption=%s&track1=%s&track2=%s&track3=%s&track1Status=%s&track2Status=%s&track3Status=%s&track1Encrypted=%s&track2Encrypted=%s&track3Encrypted=%s&track1EncryptedStatus=%s&track2EncryptedStatus=%s&track1EncryptedStatus=%s&ksn=%s')";
      cardReader.setEMML(temp);
     }
     else if (SelectedItem == "JavaScript") 
     {
     cardReader.readEvent= "MyReadEvent('%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')";
        //temp = "readevent:url('javascript:MyReadEvent('%s', '%s');')";
     }
    else if(SelectedItem == "DETACHEVENT")
    {
     cardReader.readEvent= "";
   
    }
    else if(SelectedItem == "EMPTYEVENT")
    {
     cardReader.setEMML("readevent:");
    }
    else if(SelectedItem == "JSON")
    {
    cardReader.readEvent= "MyReadEventjson(%json)";
    alert("Json event");
    }
    Message.innerHTML="Message:"+temp;
}


function MyReadEvent(data,mode,encryption,rawData,track1,track2,track3,track1Status,track2Status,track3Status,track1Encrypted,track2Encrypted,track3Encrypted,track1EncryptedStatus,track2EncryptedStatus,track3EncryptedStatus,ksn)
{	
//Message.innerHTML="Data:- "+data+"Mode:- "+mode+"Encryption:- "+encryption+"RawData:- "+rawData+"Track1:- "+track1+"Track2:- "+track2+"Track3:- "+track3+"Track1Status:- "+track1Status+"Track2Status:- "+track2Status+"Track3Status:- "+track3Status+"Track1Encrypted:- "+track1Encrypted+"Track2Encrypted:- "+track2Encrypted+"Track3Encrypted:- "+track3Encrypted+"Track1EncryptedStatus:- "+track1EncryptedStatus+"Track2EncryptedStatus:- "+track2EncryptedStatus+"Track3EncryptedStatus:- "+track3EncryptedStatus+"Ksn:- "+ksn;

    switch(mode)
    {
	
	case 'CR':
		frmCardReader.txtEncData.value =encryption;
		frmCardReader.txtCardData.value =data;
		frmCardReader.txtRawData.value =rawData;
		frmCardReader.txtTrack1Data.value =track1;
		frmCardReader.txtTrack2Data.value =track2;
		frmCardReader.txtTrack3Data.value =track3;
		frmCardReader.txtTrack1Status.value =track1Status;
		frmCardReader.txtTrack2Status.value =track2Status;
		frmCardReader.txtTrack3Status.value =track3Status;
		frmCardReader.txtTrack1EnceData.value =track1Encrypted;
		frmCardReader.txtTrack2EnceData.value =track2Encrypted;
		frmCardReader.txtTrack3EnceData.value =track3Encrypted;
		frmCardReader.txtTrack1EncStatus.value =track1EncryptedStatus;
		frmCardReader.txtTrack2EncStatus.value =track2EncryptedStatus;
		frmCardReader.txtTrack3EncStatus.value =track3EncryptedStatus;	
		frmCardReader.txtTKSNData.value =ksn;
		//ProcessCardData(data);
		break;
	case 'ENCDATA':
		frmCardReader.txtCardData.value ="Encrypted data:- "+data;
		break;
	case 'MESSAGE':
		frmCardReader.txtCardData.value ="Error:- "+data;
		break;
	case 'PAN':
		frmCardReader.txtCardData.value ="PAN:- "+data;
	    Message.innerHTML="Message:"+"Please turn the unit over and enter the PIN";
		
		break;		
    }					
}

function MyReadEventjson(jsonObject)
{	
//Message.innerHTML="Message:using json"+jsonObject.data+jsonObject.mode+jsonObject.encryption+jsonObject.rawData+jsonObject.track1+jsonObject.track2+jsonObject.track3+jsonObject.track1Status+jsonObject.track2Status+jsonObject.track3Status+jsonObject.track1Encrypted+jsonObject.track2Encrypted+jsonObject.track3Encrypted+jsonObject.track1EncryptedStatus+jsonObject.track2EncryptedStatus+jsonObject.track3EncryptedStatus+jsonObject.ksn;
 //alert("Data:- "+jsonObject.data+"Mode:- "+jsonObject.mode+"Encryption:- "+jsonObject.encryption+"RawData:- "+jsonObject.rawData+"Track1:- "+jsonObject.track1+"Track2:- "+jsonObject.track2+"Track3:- "+jsonObject.track3+"Track1Status:- "+jsonObject.track1Status+"Track2Status:- "+jsonObject.track2Status+"Track3Status:- "+jsonObject.track3Status+"Track1Encrypted:- "+jsonObject.track1Encrypted+"Track2Encrypted:- "+jsonObject.track2Encrypted+"Track3Encrypted:- "+jsonObject.track3Encrypted+"Track1EncryptedStatus:- "+jsonObject.track1EncryptedStatus+"Track2EncryptedStatus:- "+jsonObject.track2EncryptedStatus+"Track3EncryptedStatus:- "+jsonObject.track3EncryptedStatus+"Ksn:- "+jsonObject.ksn);

    switch(jsonObject.mode)
    {
	
	case 'CR':
	   
		frmCardReader.txtEncData.value =jsonObject.encryption;
		frmCardReader.txtCardData.value =jsonObject.data;
		frmCardReader.txtRawData.value =jsonObject.rawData;
		frmCardReader.txtTrack1Data.value =jsonObject.track1;
		frmCardReader.txtTrack2Data.value =jsonObject.track2;
		frmCardReader.txtTrack3Data.value =jsonObject.track3;
		frmCardReader.txtTrack1Status.value =jsonObject.track1Status;
		frmCardReader.txtTrack2Status.value =jsonObject.track2Status;
		frmCardReader.txtTrack3Status.value =jsonObject.track3Status;
		frmCardReader.txtTrack1EnceData.value =jsonObject.track1Encrypted;
		frmCardReader.txtTrack2EnceData.value =jsonObject.track2Encrypted;
		frmCardReader.txtTrack3EnceData.value =jsonObject.track3Encrypted;
		frmCardReader.txtTrack1EncStatus.value =jsonObject.track1EncryptedStatus;
		frmCardReader.txtTrack2EncStatus.value =jsonObject.track2EncryptedStatus;
		frmCardReader.txtTrack3EncStatus.value =jsonObject.track3EncryptedStatus;	
		frmCardReader.txtTKSNData.value =jsonObject.ksn;
		//frmCardReader.txtCardData.value ="Encrypted data:- "+jsonObject.Data;
		//ProcessCardData(jsonObject.Data);
		break;
	case 'ENCDATA':
		frmCardReader.txtCardData.value ="Encrypted data:- "+jsonObject.data;
		break;
	case 'MESSAGE':
		frmCardReader.txtCardData.value ="Error:- "+jsonObject.data;
		break;
	case 'PAN':
		frmCardReader.txtCardData.value ="PAN:- "+jsonObject.data;
		Message.innerHTML="Message:"+"Please turn the unit over and enter the PIN";
		break;		
    }					
}


/*function ProcessCardData(data)
{
    var carddata=data;
    var Track1Data,Track2Data,Track3Data;
    Track1Data="NULL";
    Track2Data="NULL";
    Track3Data="NULL";
    
    var position1 = carddata.indexOf('%');
    var position2 = carddata.indexOf('?');
    var carddatalength = carddata.length;
    if((position1==-1)||(position2==-1))
    {
        Track1Data="NULL";
    }
    else
    {
        Track1Data = carddata.substring(position1,position2);
        carddata=carddata.substring(position2+1,carddatalength);
        carddatalength=carddata.length;
    }

    position1=carddata.indexOf(';');
    position2=carddata.indexOf('?');

    if((position1==-1)||(position2==-1))
    {
        Track2Data="NULL";
    }
    else
    {
        Track2Data = carddata.substring(position1,position2);
        carddata=carddata.substring(position2+1,carddatalength);
        carddatalength=carddata.length;
    }

    if(SelectedMSR=="MSR9001")
    {
        position1=carddata.indexOf('+');
    }
    else
    {
        position1=carddata.indexOf(';');
    }
    position2=carddata.indexOf('?');

    if((position1==-1)||(position2==-1))
    {
        Track3Data="NULL";
    }
    else
    {
        Track3Data = carddata.substring(position1,position2);
    }


    frmCardReader.txtTrack1Data.value=Track1Data;
    frmCardReader.txtTrack2Data.value=Track2Data;
    frmCardReader.txtTrack3Data.value=Track3Data;
}*/


function OpenMSR()
{
    SelectAppropriateMSR();
    SetAutoEnter();
    SetAutoTab();
    SetPinEntry();
    SetPinTimeout();
    cardReader.open();
    //cardReader.readEvent= "MyReadEventjson(%json);";
 
}

function CloseMSR()
{
    cardReader.close();
    alert("Closed");
}

function ClearTextboxes()
{  
        frmCardReader.txtEncData.value ="";
		frmCardReader.txtCardData.value ="";
		frmCardReader.txtRawData.value ="";
		frmCardReader.txtTrack1Data.value ="";
		frmCardReader.txtTrack2Data.value ="";
		frmCardReader.txtTrack3Data.value ="";
		frmCardReader.txtTrack1Status.value ="";
		frmCardReader.txtTrack2Status.value ="";
		frmCardReader.txtTrack3Status.value ="";
		frmCardReader.txtTrack1EnceData.value ="";
		frmCardReader.txtTrack2EnceData.value ="";
		frmCardReader.txtTrack3EnceData.value ="";
		frmCardReader.txtTrack1EncStatus.value ="";
		frmCardReader.txtTrack2EncStatus.value ="";
		frmCardReader.txtTrack3EncStatus.value ="";	
		frmCardReader.txtTKSNData.value ="";
}


function SelectAppropriateMSR()
{
    
    for (var i=0; i < frmCardReader.group1.length; i++)
   	{   
     	if (frmCardReader.group1[i].checked)
      		{
      		SelectedMSR= frmCardReader.group1[i].value;
      	    }
   	}	
    alert("SelectedMSR:- "+SelectedMSR);
    if(SelectedMSR != "DEFAULT")
    {
    cardReader.moduleName=SelectedMSR;
    }
  
}

function SetAutoEnter()
{
     
    var AutoEnterValue="";
    for (var i=0; i < frmCardReader.group3.length; i++)
   	{   
     	if (frmCardReader.group3[i].checked)
      		{
      		    
      		AutoEnterValue= frmCardReader.group3[i].value;
      			
      	}
   	}	


    if(AutoEnterValue!="DEFAULT")
    {
    cardReader.autoEnter=AutoEnterValue;
    }
    

}


function SetAutoTab()
{
    var AutoTabValue="";
    for (var i=0; i < frmCardReader.group4.length; i++)
   	{   
     	if (frmCardReader.group4[i].checked)
      		{
      		    
      		AutoTabValue= frmCardReader.group4[i].value;
      			
      	}
   	}	
   
    if(AutoTabValue!="DEFAULT")
    {
    cardReader.autoTab=AutoTabValue;
    }


}

function SetPinEntry()
{

 var PinEntryValue="";
 
 for (var i=0; i < frmCardReader.group5.length; i++)
   	{   
     	if (frmCardReader.group5[i].checked)
      		{
      		    
      		PinEntryValue= frmCardReader.group5[i].value;
      			
         	}
   	}	
   	
    if(PinEntryValue!="DEFAULT")
    {
    cardReader.pinEntry=PinEntryValue;
    }
   	
   	
}




function SetPinTimeout()
{
    var PinTimeout="";
    var temp="";
    PinTimeout=frmCardReader.txt1.value;
    
    if(PinTimeout!="DEFAULT")
    {
    cardReader.pinTimeout=PinTimeout;
    }
}



function SetPANData()
{
    var PANData="";
    var temp="";
    PANData=frmCardReader.Textarea1.value;
    
    
    if(PANData!="DEFAULT")
    {
      cardReader.panData=PANData;
    }
}

</script>