<html>
<head>
	<title>Camera Stress Test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<META HTTP-Equiv="MinimizeButton" content="visibility:Visible;top:30 " >
	<META HTTP-Equiv="quitbutton" Content="visibility:visible">
	<META HTTP-Equiv="ReloadButton" Content="visibility:visible">
	
    <script type="text/javascript" charset="utf-8" src="/public/jquery/jquery-1.6.4.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="/public/jquery/jquery.json-2.3.min.js"></script>
    <script type="text/javascript" src="/public/api/rhoapi-modules.js"></script>
  	<script type = "text/javascript">
      var enumData;
      var cameraObj;
      var cameratype;
      var count = 0;
      var status = '';
      var enumFunc = function() {
        enumData = Rho.Camera.enumerate();
        if (enumData.length > 0){
          for (i=0; i < enumData.length; i++){
              document.getElementById('cameradropdown').options[i + 1].text = enumData[i].getProperty('ID') + ' ' + enumData[i].getProperty('cameraType');
              document.getElementById('cameradropdown').options[i + 1].value = enumData[i].getProperty('cameraType');
          }
        }else{
          alert("cameras not available in this device");
        }
      }
      var selectCamera = function () {
        var w = document.getElementById('cameradropdown').selectedIndex;
        cameratype = document.getElementById('cameradropdown').options[w].value;
      }
      var initiateCamera = function(){
        cameraObj = Rho.Camera.getCameraByType(cameratype);
        cameraObj.showPreview({'outputFormat':'image', 'fileName' : 'cameraStressedImage'});
        document.getElementById("msg").innerHTML = 'Preview enabled';
        setTimeout(function(){
          doCapture();
        },6000);
      }
      var callbackFunc = function (data) {
        status = data.status
      }
      function doCapture(){
        if(count <= 50000){  
          status = '';
          document.getElementById("mycount").innerHTML = "Capture count: " + count;
          cameraObj.capture(callbackFunc);

          setTimeout(function(){
            if (status == 'ok'){
              count++;
              captureLoop();  
            }else{
              document.getElementById("msg").innerHTML = count + 'th capture failed';
            }
          }, 5000);
        }
      }
      function captureLoop(){
        setTimeout("doCapture()", 30000);
      }
  	</script>

</head>
<body >
Capture Stress Test
<br />
<p>Steps: <br>
  <ul>
    <li>Press 'Enumerate'.</li>
    <li>Select one enumerated camera/imager</li>
    <li>Press 'Run Test'</li>
    <li>Keep for stress similarly other enumerated camera(s) if any</li>
  </ul>
</p>
<br />
<button onclick="enumFunc();">Enumerate Cameras</button><br><br>
<span class="heading">
  Select the Camera: &nbsp;&nbsp;<select name="cameradropdown" id="cameradropdown" onChange="selectCamera()">
    <option value="" selected>--Select Camera--</option>
    <option value={}></option>
    <option value={}></option>
  </select>
</span>

<br>
<br>
<button onclick="initiateCamera();">Run Test</button><br><br>
<div id="mycount"></div>
<div id="msg"></div>

<button onclick="location.href='../cam_index.html'"> Back </button>



</body>
</html>