var APS=APS||{};function getVar(key){var val;eval("if(typeof "+key+" != 'undefined') val = "+key);try{if(typeof top[key]!="undefined"){val=top[key]}}catch(e){}return val}function setVar(key,val){eval("if(typeof "+key+" != 'undefined') var "+key+";");eval(key+"= '"+val+"';");try{top[key]=val}catch(e){}}function getAdxUID(){var a=null;try{if(window.frameElement&&window.frameElement.id.lastIndexOf("_")!=-1){a=window.frameElement.id.substring(window.frameElement.id.lastIndexOf("_")+1)}else{a=getVar("uid")}}catch(b){try{a=getVar("uid")}catch(c){}}return a}var layerid=0;var adxUID=getAdxUID();APS.DealsHandler=function(h){var e=this;this.partner=h.partner;this.cityStr=h.city;this.city=this.cityStr.toLowerCase();this.cid="";this.curDeal;this.share=null;this.util=new APS.Util();this.dealsbasepath="http://d.yimg.com/qc/deals/gmarket/raw/"+this.partner+"?"+Math.random();if(h.datasystem=="static"||h.datasystem=="staticraw"){this.dealsbasepath="http://d.yimg.com/qc/deals"}this.dealsconf="";this.curArea=null;this.dr=null;this.useBrowserTime=true;this.cmpid=h.cmpid;this.currentServerTime=Math.floor(new Date().getTime()/1000);this.serverTimeMS=this.currentServerTime*1000;this.serverTimeDateObj=new Date(Math.floor(this.serverTimeMS));this.localDateObj=new Date();this.initLocalTimeMS=this.localDateObj.getTime();this.numDeals=0;this.displayNumDeals=1;this.adx_data_template="apsdeals,aidxx,C="+this.cmpid+",P=xx,A=na,L=xx,K=xx";this.adx_data=this.adx_data_template;this.tracker=new APS.Track(this.adx_data);this.dealsLoadStatus=false;this.endTimeObj=null;this.timeOutRef=null;this.imgNum=0;this.delayLoad=true;this.clickURL="";this.defaultLandingUrl="";this.tlNeeded=false;this.imgBuf=false;this.imgElementsCreated=[];this.divStaticRef;this.divDynRef;this.tlElem=[];this.defaultImgUrl="";this.adsystem="ruby";this.btlist=[];this.randomize=false;this.currentDealsList=[];if(h.randomize!=undefined&&h.randomize!=null){this.randomize=h.randomize}this.conf=new Object();this.conf.currency="";if(h.title_id!=undefined){this.conf.title_id=h.title_id}if(h.title_length!=undefined){this.conf.title_length=h.title_length}if(h.desc_id!=undefined){this.conf.desc_id=h.desc_id}if(h.desc_length!=undefined){this.conf.desc_length=h.desc_length}if(h.orig_prc_id!=undefined){this.conf.orig_prc_id=h.orig_prc_id}if(h.discounted_prc_id!=undefined){this.conf.discounted_prc_id=h.discounted_prc_id}if(h.discount_percent_id!=undefined){this.conf.discount_percent_id=h.discount_percent_id}if(h.vendor_id!=undefined){this.conf.vendor_id=h.vendor_id}if(h.vendor_length!=undefined){this.conf.vendor_length=h.vendor_length}if(h.city_id!=undefined){this.conf.city_id=h.city_id}if(h.currency!=undefined){this.conf.currency=h.currency}if(h.img_id!=undefined){this.conf.img_id=h.img_id}if(h.img_container_id!=undefined){this.conf.img_container_id=h.img_container_id}if(h.imgsize!=undefined){this.conf.imgsize=h.imgsize}if(h.bufimg_id!=undefined){this.conf.bufimg_id=h.bufimg_id}if(h.multibind!=undefined){this.conf.multibind=h.multibind}if(h.num_products!=undefined){this.conf.num_products=h.num_products;this.displayNumDeals=this.conf.num_products}if(h.link_id_list!=undefined){this.conf.link_id_list=h.link_id_list}if(h.samecategory!=undefined){this.conf.samecategory=h.samecategory?1:0}if(h.mvnext_id!=undefined){this.conf.mvnext_id=h.mvnext_id;document.getElementById(this.conf.mvnext_id).onclick=function(){e.handleMoveNext()}}if(h.mvprev_id!=undefined){this.conf.mvprev_id=h.mvprev_id;document.getElementById(this.conf.mvprev_id).onclick=function(){e.handleMovePrev()}}if(h.adsystem!=undefined){this.adsystem=h.adsystem}if(h.adsystem=="ruby"&&h.ruby_clickurl!="%rd%/%space%"){this.clickURL=h.ruby_clickurl}else{if(h.adsystem=="apt"&&h.apt_clickurl!="${CLICKURL}"){this.clickURL=h.apt_clickurl}else{if(h.adsystem=="rmx"&&h.rmx_clickurl!="${CLICKURL}"){this.clickURL=h.rmx_clickurl}}}if(h.default_landingurl!=undefined){this.defaultLandingUrl=h.default_landingurl}if(h.default_imgurl!=undefined){this.defaultImgUrl=h.default_imgurl}if(h.tlcounter!=undefined){this.tlNeeded=h.tlcounter}if(h.img_buf!=undefined){this.imgBuf=h.img_buf}if(h.staticad_id!=undefined){this.divStaticRef=document.getElementById(h.staticad_id)}if(h.dynad_id!=undefined){this.divDynRef=document.getElementById(h.dynad_id)}if(h.tlhr!=undefined){this.tlElem.tlhr=h.tlhr}if(h.tlmin!=undefined){this.tlElem.tlmin=h.tlmin}if(h.tlsec!=undefined){this.tlElem.tlsec=h.tlsec}var b="";var j="";if(h.adsystem=="rmx"){if(h.rmxqs!=undefined&&h.rmxqs!=""&&h.rmxqs!="${QUERY_STRING}"){var f=h.rmxqs.split("&");for(var d=0;d<f.length;d++){var g=f[d];if(g.indexOf("category=")>-1){this.publisherCategory=decodeURIComponent(g.split("=")[1])}else{if(g.indexOf("ybt=")>-1){b=decodeURIComponent(g.split("=")[1])}else{if(g.indexOf("ycbt=")>-1){j=decodeURIComponent(g.split("=")[1])}else{if(g.indexOf("city=")>-1){var c=decodeURIComponent(g.split("=")[1]);this.city=APS.advCityList[APS.publisherCityList[c.toLowerCase()]].toLowerCase();this.cityStr=this.city}}}}}}}else{if(h.adsystem=="ruby"){if(h.bt1!=undefined&&h.bt1!="%bt2set_noenc%"){b=decodeURIComponent(h.bt1)}if(h.bt2!=undefined&&h.bt2!="%custbtseg%"){j=decodeURIComponent(h.bt2)}}}if(b!=undefined&&b!=""){this.btlist=b.split(";").slice(0,50)}if(j!=undefined&&j!=""){this.btlist=this.btlist.concat(j.split(";").slice(0,50))}this.dealsconf="?partner="+h.partner+"&city="+this.city;if(h.alldeals!=undefined&&h.alldeals){this.dealsconf+="&alldeals=1"}else{if(h.num_products!=undefined&&h.num_products>1){this.dealsconf+="&numdeals="+this.conf.num_products;if(h.samecategory!=undefined&&h.samecategory==1){this.dealsconf+="&sc="+this.conf.samecategory}}}if(this.btlist.length>0){this.dealsconf+="&bt="+this.btlist.join(";")}if(h.datasystem=="static"){this.dealsconf="/"+h.partner+"/approved/"+h.partner+"_"+this.city}else{if(h.datasystem=="staticraw"){this.dealsconf="/"+h.partner+"/raw/"+h.partner+"_"+this.city+"_"+h.feeddt}}var a=this.dealsbasepath;this.dr=APS.PropertyReaderFactory.getInstance(APS.PropertyReaderFactory.DEALS_READER,a,this.dealsloaded,this,this.partner);this.needAutoCarousel=false;if(h.autoCarousel!=undefined){this.needAutoCarousel=h.autoCarousel}};APS.DealsHandler.prototype.dealsloaded=function(b,a){this.dealsLoadStatus=a;if(this.dr==null){this.dr=b}var c=this;if(this.dealsLoadStatus){this.numDeals=this.dr.getNumDeals();if(this.numDeals>0){this.displayNextPrev(this.numDeals);this.displayAd(true);this.dr.resetRecordNum();if(this.randomize){this.dr.randomize()}this.curDeal=this.dr.getCurrent();setTimeout(function(){c.delayedLoad1()},500);this.displayDeal(this.curDeal);if(this.needAutoCarousel){this.startAutoCarousal()}}else{this.displayAd(false);setTimeout(function(){c.delayedLoad1()},500)}}else{this.displayAd(false);setTimeout(function(){c.delayedLoad1()},500)}};APS.DealsHandler.prototype.displayNextPrev=function(a){if(a>1){if(this.conf.mvnext_id!=undefined&&this.conf.mvnext_id){document.getElementById(this.conf.mvnext_id).style.display="block";document.getElementById(this.conf.mvprev_id).style.display="block";if(this.needAutoCarousel){this.startAutoCarousal()}}}else{if(this.conf.mvnext_id!=undefined&&this.conf.mvnext_id){document.getElementById(this.conf.mvnext_id).style.display="none";document.getElementById(this.conf.mvprev_id).style.display="none"}}};APS.DealsHandler.prototype.displayAd=function(a){if(a){this.divDynRef.style.display="block";this.divStaticRef.style.display="none"}else{this.divDynRef.style.display="none";this.divStaticRef.style.backgroundImage="url('"+this.defaultImgUrl+"')";this.divStaticRef.style.display="block"}};APS.DealsHandler.prototype.formatDateMonth=function(a){return(a<=9)?"0"+a:a};APS.DealsHandler.prototype.startCounter=function(b){if(this.tlNeeded){var a=this;this.endTimeObj=b;if(this.tlNeeded){this.timeOutRef=setInterval(function(){a.updateCounter()},1000);a.updateCounter()}}};APS.DealsHandler.prototype.stopCounter=function(){if(this.tlNeeded){if(this.timeOutRef!=null){clearInterval(this.timeOutRef)}var b=document.getElementById(this.tlElem.tlhr);var c=document.getElementById(this.tlElem.tlmin);var a=document.getElementById(this.tlElem.tlsec);b.innerHTML="";c.innerHTML="";a.innerHTML=""}};APS.DealsHandler.prototype.updateCounter=function(){if(this.tlNeeded){var b=this.util.getTimeLeft(this.endTimeObj,this.serverTimeMS,this.initLocalTimeMS);var c=document.getElementById(this.tlElem.tlhr);var d=document.getElementById(this.tlElem.tlmin);var a=document.getElementById(this.tlElem.tlsec);if(b.valid>0){c.innerHTML=b.h;d.innerHTML=b.m;a.innerHTML=b.s}else{c.innerHTML="00";d.innerHTML="00";a.innerHTML="00"}}};APS.DealsHandler.prototype.displayDeal=function(k){this.currentDealsList=[];this.currentDealsList.push(k);var o=k.getImage.call(k);var m=k.getTitle();var r=k.getDescription();if(this.conf.title_length!=undefined&&m.length>this.conf.title_length){m=m.substring(0,this.conf.title_length)}if(this.conf.desc_length!=undefined&&r.length>this.conf.desc_length){r=r.substring(0,this.conf.desc_length)}var n=k.getOriginalPrice();var q=k.getListingPrice();var j=k.getListingId();var A=k.getDiscount();var d=k.getArea();var f=k.getVendor();var x=k.getProduct();var p;var l="",a="";var s,u;if(this.conf.imgsize!=undefined&&this.conf.imgsize!=""){if(o.lastIndexOf("_")>-1){var c=o.substring(0,o.lastIndexOf("_"));var y=o.substring(o.lastIndexOf("_"));var B=y.substring(y.indexOf("."));o=c+"_"+this.conf.imgsize+B}}var w="";for(var z=0;z<this.displayNumDeals;z++){if(this.conf.multibind){w="_"+z;if(z>0){k=this.dr.getNext(this.curArea);this.currentDealsList.push(k);this.curDeal=k;o=k.getImage.call(k);m=k.getTitle();r=k.getDescription();if(this.conf.title_length!=undefined&&m.length>this.conf.title_length){m=m.substring(0,this.conf.title_length)}if(this.conf.desc_length!=undefined&&r.length>this.conf.desc_length){r=r.substring(0,this.conf.desc_length)}n=k.getOriginalPrice();q=k.getListingPrice();j=k.getListingId();A=k.getDiscount();d=k.getArea();f=k.getVendor();x=k.getProduct()}}if(this.imgElementsCreated.length<=z){this.imgElementsCreated[z]=false}if(!this.imgElementsCreated[z]){s=document.createElement("img");s.id=this.conf.img_container_id+"_0"+w;s.style.display="none";this.conf["img_id"+w]=s.id;if(this.imgBuf){u=document.createElement("img");u.id=this.conf.img_container_id+"_1"+w;u.style.display="none";this.conf["bufimg_id"+w]=u.id}}if(this.imgNum==0){l=this.conf["img_id"+w];a=l;if(this.conf["bufimg_id"+w]!=undefined){a=this.conf["bufimg_id"+w]}}else{l=this.conf["img_id"+w];a=l;if(this.conf["bufimg_id"+w]!=undefined){l=this.conf["bufimg_id"+w];a=this.conf["img_id"+w]}}if(!this.imgElementsCreated[z]){p=s}else{p=document.getElementById(l)}if(p.src!=o){p.src=o;p.style.display=""}if(!this.imgElementsCreated[z]){document.getElementById(this.conf.img_container_id+w).appendChild(s);if(this.imgBuf){document.getElementById(this.conf.img_container_id+w).appendChild(u)}this.imgElementsCreated[z]=true}if(this.imgBuf){this.imgNum=this.imgNum?this.imgNum-1:this.imgNum+1;var F=document.getElementById(a);if(F!=undefined){p.style.display="";F.style.display="none"}}var E=f;if(this.conf.vendor_length!=undefined&&f.length>this.conf.vendor_length){E=f.substring(0,this.conf.vendor_length)+".."}if(document.getElementById(this.conf.title_id+w)!=undefined){document.getElementById(this.conf.title_id+w).innerHTML=m}if(document.getElementById(this.conf.desc_id+w)!=undefined){document.getElementById(this.conf.desc_id+w).innerHTML=r}if(document.getElementById(this.conf.orig_prc_id+w)!=undefined){document.getElementById(this.conf.orig_prc_id+w).innerHTML=this.conf.currency+n}if(document.getElementById(this.conf.discounted_prc_id+w)!=undefined){document.getElementById(this.conf.discounted_prc_id+w).innerHTML=this.conf.currency+q}if(document.getElementById(this.conf.discount_percent_id+w)!=undefined){document.getElementById(this.conf.discount_percent_id+w).innerHTML=A}if(document.getElementById(this.conf.vendor_id+w)!=undefined){document.getElementById(this.conf.vendor_id+w).innerHTML=E}if(document.getElementById(this.conf.city_id+w)!=undefined){document.getElementById(this.conf.city_id+w).innerHTML=this.cityStr}var b;if(this.conf.link_id_list!=undefined){var D=this.conf.link_id_list;for(var e=0;e<D.length;e++){b=document.getElementById(D[e]["id"]+w);if(b!=undefined){b.setAttribute("href",this.getBeacon(k.getField(D[e]["link"])));b.innerHTML=k.getField(D[e]["text"])}}}var C=k.getDealDates();var t=C.ed;var h=this.util.parseDate(t);this.stopCounter();this.startCounter(h)}var g=this;if(!this.delayLoad){var i=this.dr.lookupNext();if(this.imgBuf){var v=i.getImage.call(i);if(F!=undefined){F.src=v}}}else{setTimeout(function(){g.delayedLoad2()},2000);this.delayLoad=false}};APS.DealsHandler.prototype.delayedLoad1=function(){var a="";var e="";if(this.dealsLoadStatus&&this.currentDealsList.length>0){for(var d=0;d<this.currentDealsList.length;d++){if(d==0){e=this.currentDealsList[d].getListingId();a+=e}else{a+="-"+this.currentDealsList[d].getListingId()}}var c=this.curDeal.getField("log_data");var f=this.curDeal.getField("model");if(f==""||f==undefined){f="random"}if(c!=undefined&&c!=null&&c!=""){var b=this.adx_data_template.replace("aidxx",c);this.tracker.parseAdxData(b)}this.tracker.trackBeapEvent("","ai","viewdeal_"+e+"_"+this.city+"_"+f+"_na_"+this.partner)}else{this.tracker.trackBeapEvent("","ai","viewdealdef_")}};APS.DealsHandler.prototype.delayedLoad2=function(){var e="",d="";if(this.imgNum==0){e=this.conf.img_id;d=e;if(this.conf.bufimg_id!=undefined){d=this.conf.bufimg_id}}else{e=this.conf.img_id;d=e;if(this.conf.bufimg_id!=undefined){e=this.conf.bufimg_id;d=this.conf.img_id}}var b=document.getElementById(d);var g=this.dr.lookupNext();var a=g.getImage.call(g);if(b!=undefined){if(this.conf.imgsize!=undefined&&this.conf.imgsize!=""){if(a.lastIndexOf("_")>-1){var c=a.substring(0,a.lastIndexOf("_"));var h=a.substring(a.lastIndexOf("_"));var f=h.substring(h.indexOf("."));a=c+"_"+this.conf.imgsize+f}}b.src=a}};APS.DealsHandler.prototype.handleMoveNext=function(){this.curDeal=this.dr.getNext(this.curArea);this.displayDeal(this.curDeal)};APS.DealsHandler.prototype.handleMovePrev=function(){this.curDeal=this.dr.getPrevious(this.curArea);this.displayDeal(this.curDeal)};APS.DealsHandler.prototype.handleURLClick=function(g){var f=this.conf.link_id_list;var a=null;var j;var b="";if(g==undefined||g==null){b="oneofthe4urls"}else{a=this.currentDealsList[g];b=(f[g]["link"])}if(a!=null){this.city=a.getField("city");j=a.getField("model")}if(j==""||j==undefined){j="random"}if(this.city==""||this.city==undefined){this.city="all"}var c="click_"+b+"_"+this.city+"_"+j+"_na_"+this.partner;this.tracker.trackBeapEvent("","ac",c)};APS.DealsHandler.prototype.handleAdClick=function(e){var a;var d;var g=null;if(e==undefined||e==null){g=this.curDeal}else{g=this.currentDealsList[e]}if(g!=null){this.city=g.getField("city");var b=g.getField("log_data");var f=g.getField("model");var c=g.getListingId();if(f==""||f==undefined){f="random"}if(this.city==""||this.city==undefined){this.city="all"}d="click_"+c+"_"+this.city+"_"+f+"_na_"+this.partner;a=g.getBuyLink()}else{d="clickdef_";a=this.defaultLandingUrl}a=this.getBeacon(a,d,"click_");window.open(a,"_blank");this.tracker.trackBeapEvent("","ac",d)};APS.DealsHandler.prototype.getBeacon=function(d,c,a){var b;b=d;if(this.clickURL!=""&&this.adsystem=="ruby"){b=this.clickURL+"/*"+b}else{if(this.clickURL!=""&&this.adsystem=="rmx"){b=this.clickURL+encodeURIComponent(b)}else{if(this.clickURL!=""&&this.adsystem=="apt"){b=this.clickURL+b}}}return b};APS.DealsHandler.prototype.autoCarousalIntRef=null;APS.DealsHandler.prototype.autoCarousal=false;APS.DealsHandler.prototype.startAutoCarousal=function(){if(this.numDeals>1&&!this.autoCarousal&&this.autoCarousalIntRef==null){var a=this;this.autoCarousalIntRef=setInterval(function(){a.handleMoveNext()},25000);this.autoCarousal=true}};APS.DealsHandler.prototype.stopAutoCarousal=function(){this.autoCarousal=false;if(this.autoCarousalIntRef!=null){clearInterval(this.autoCarousalIntRef);this.autoCarousalIntRef=null}};APS.Util=function(){};APS.Util.prototype.getUrlParam=getVar;APS.Util.prototype.setUrlParam=setVar;APS.Util.prototype.getCurrentChannel=function(){var a;try{a="dummy.yahoo.com"}catch(b){a="undefined"}return(a)};APS.Util.prototype.getTrackingParams=function(f,b,h){var d;var c;var e=getVar("socad_uid");if(e==undefined||e==null){e=this.getUserId()}var j="";var i="";var g="";var a=new Array();a.ch=this.getCurrentChannel();if(h){a.ouid=(d==undefined)?e:d;a.suid=e;a.sch=a.ch}else{a.uid=e;if(d!=undefined&&d!=""){a.ouid=d;a.suid=c}a.sch=i==undefined?"":i}a.dch=f;a.destChnl=f;a.label=(!b)?"undefined":b;return a};APS.Util.prototype.getHashValue=function(a){var c=["a","b","c","1","d","9","e","f","g","5","h","i","0","j","k","3","l","m","n","o","8","p","q","7","r","s","t","u","v","6","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","4","N","O","P","Q","R","S","2","T","U","V","W","X","Y","Z"];var e=61;var d;var g="";var f;var b=a;while(b>e){f=Math.floor(b/e);d=b-f*e;if(d>61||d<0){d=Math.floor(Math.abs(d)/62)}g+=""+c[d];b=f}return(g+c[b])};APS.Util.prototype.getUserId=function(){var a;a=getVar("socad_uid");if(a==undefined||a==null){a=""+this.getHashValue(Math.floor(Math.random()*1000000)*10000000000000+Number(new Date()));setVar("socad_uid",a)}return a};APS.Util.prototype.beapFormat=function(a,b){return this.beap_clean(a)+"$"+this.beap_clean(b)};APS.Util.prototype.beap_clean=function(a){return((a)?escape(a):"")};APS.Util.prototype.sendRequest=function(c,b){var a=new Image();a.onload=a.onerror=function(){if(b){}a.onload=a.onerror=null;a=null};a.src=c};APS.Util.prototype.getAdxUID=getAdxUID;APS.Util.prototype.getNetworkProperty=function(g,f,b,a){var d=APS.PropertyReaderFactory.getInstance(APS.PropertyReaderFactory.SOCAD_CONFIG_READER);var c=null;var e="";if(a!=null){if(b!=undefined&&b!=null&&b!=""){e=b+"."+a+"."+g;c=this.getOverriddenNetworkProperty(d,f,e);if(c==null){e=b+".default."+g;c=this.getOverriddenNetworkProperty(d,f,e)}}if(c==null){e=a+"."+g;c=this.getOverriddenNetworkProperty(d,f,e)}if(c==null){e="default."+g;c=this.getOverriddenNetworkProperty(d,f,e)}}else{c=this.getOverriddenNetworkProperty(d,f,g)}return c};APS.Util.prototype.getOverriddenNetworkProperty=function(b,d,c){var a;if(d!=null&&d[c]!=undefined){a=d[c]}else{a=b.get(c)}return a};APS.Util.prototype.escapeHtmlEntities=function(a){a=a.split('"').join("&quot;");a=a.split("<").join("&lt;");a=a.split(">").join("&gt;");return a};APS.Util.prototype.openPopup=function(a,b){if(b==undefined||b==null){b="_blank"}window.open(a,b,"height=500,width=800,toolbar=no,scrollbars=yes,resizable=yes")};APS.Util.prototype.openPopupWithVars=function(e,c){var b=window.open("","_blank","height=500,width=800,toolbar=no,scrollbars=yes,resizable=yes");var f="<html><head><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>";f+="</head><body><form id='formid' accept-charset='UTF-8' method='post' action='"+e+"'>";for(var a in c){var d=encodeURIComponent(c[a]);f+="<input type='hidden' name='"+a+"' value='"+d+"'/>"}f+="</form><script type='text/javascript'>";f+="var frm = document.getElementById('formid');";f+="for(var i = 0; i < frm.elements.length; i++){";f+="frm.elements[i].value = decodeURIComponent(frm.elements[i].value);";f+="/*alert(frm.elements[i].name + ' ' + frm.elements[i].value)*/";f+="}";f+="frm.submit();";f+="<\/script></body></html>";b.document.write(f)};APS.Util.prototype.parseDate=function(a){var c=a.split(" ");var b=c[0].split("-");var e=c[1].split(":");var d=new Date();d.setFullYear(b[0]);d.setMonth(Number(b[1])-1,b[2]);d.setDate(b[2]);d.setHours(e[0]);d.setMinutes(e[1]);d.setSeconds(e[2]);return d};APS.Util.prototype.getTimeLeft=function(k,a,i){var b=new Date().getTime();var h=b-i;var d=k.getTime();var f=d-(a+h);var j=new Object();if(f<=0){f=0}var g=Math.floor(f/1000);var m=Math.floor(g/3600);var e=g-(m*3600);var l=Math.floor(e/60);var c=Math.floor(e-(l*60));j.h=m;j.m=l;j.s=c;j.valid=m+l+c;return j};APS.Track=function(a){this.protocol="http";this.beapServerName="beap.adx.yahoo.com";this.beapScriptName="reg_rm";this.beapVer="1.0.0";this.beaconParamsToEncode=["uid","ouid","suid","ch","sch","dch"];this.social_ad_params={ty:"rm",aid:"xxxxxxxxx",pid:"xxxxxx",cid:"xxxxxx",lid:"xxxxx",advid:"xxxxxxxx",cmpid:"xxx"};this.beapEventCountMap={view_video:"1"};this.trackingURL="http://tr.adinterax.com/";this.adxData=a;this.adxId;this.eventCountMap={};this.adxEventTypeMap={click:"tc,c",custom:"u"};this.util=new APS.Util();this.parseAdxData()};APS.Track.prototype.formBeaconUrl=function(h,e){var f=this.social_ad_params;var j="";if(this.beapServerName==undefined||this.beapServerName==null||this.beapServerName==""){return j}j=this.protocol+"://"+this.beapServerName+"/"+this.beapScriptName+"?bv="+this.beapVer;var m="";if(h==undefined||h==null||h==""){h="ua"}var l;for(var k in this.beaconParamsToEncode){l=this.beaconParamsToEncode[k];var d=e[l];if(!(d&&d.length)||l=="label"){continue}if(m.length){m+=","}m+=this.util.beapFormat(l,d)}var n=this.util.beapFormat("pid",f.pid);n+=","+this.util.beapFormat("cid",f.cid);n+=","+this.util.beapFormat("advid",f.advid);n+=","+this.util.beapFormat("lid",f.lid);n+=","+this.util.beapFormat("cmpid",f.cmpid);if(m&&m.length){n+=",sa("+m+")"}var c="cd(type$"+h+","+this.util.beapFormat("label",e.label)+")";var g=this.util.beapFormat("ty",f.ty);var a=g+",ci("+n+"),"+c;var i=this.util.beapFormat("aid",f.aid);var b="ct$36";j+="&al=("+b+","+i+",dt("+a+"))";return j};APS.Track.prototype.parseAdxData=function(g){var f=this.util.getAdxUID();if(g!=undefined&&g!=null){this.adxData=g}if(this.adxData==undefined||this.adxData==null||this.adxData=="undefined"){this.adxData=getVar("adx_data")}var e=[];if(this.adxData!=null){e=this.adxData.split(",")}if(e.length>1){this.social_ad_params.cid=e[0];this.social_ad_params.aid=e[1];var d=e.length;var c={P:"pid",C:"cmpid",A:"advid",L:"lid"};for(var b=2;b<d;b++){var a=e[b].split("=");if(a.length==2){if(c[a[0]]!=undefined){this.social_ad_params[c[a[0]]]=a[1]}}}}};APS.Track.prototype.getAdxData=function(){return this.adxData};APS.Track.prototype.trackBeapEvent=function(c,a,e,d){if(d==null||d==undefined){d=false}if(this.adxData==undefined||this.adxData==null||this.adxData==""){this.parseAdxData()}if(typeof this.beapEventCountMap[e]==="undefined"){this.beapEventCountMap[e]=0}else{this.beapEventCountMap[e]++}var b=this.beapEventCountMap[e];this.prepareAndFireBeacon(c,a,e,b,d)};APS.Track.prototype.prepareAndFireBeacon=function(e,b,a,c,f){var d=this.getBeaconUrl(e,b,a,c);this.util.sendRequest(d,f)};APS.Track.prototype.getBeaconUrl=function(e,b,a,c){if(c==undefined||c==null||!c){c="0"}a=a+":"+c;var d=this.util.getTrackingParams(e,a,false);return this.formBeaconUrl(b,d)};APS.Track.prototype.getBeaconUrlForSharedChannel=function(d,b,a){var c=this.util.getTrackingParams("",a,true);c.uid="";c.ch=d;return this.formBeaconUrl(b,c)};APS.PropertiesManager=function(){this.cb;this.ctx;this.test="test";this.initialized=false;this.rowSeparator="\n";this.loadSuccess=false};APS.PropertiesManager.prototype.readFile=function(a,c,d,b){};APS.PropertiesManager.prototype.done=function(a){this.initialized=true;if(this.cb&&this.ctx){this.cb.call(this.ctx,a,this.loadSuccess)}};APS.PropertiesManager.prototype.setLoadSuccess=function(a){this.loadSuccess=a};APS.PropertiesManager.prototype.getLoadSuccess=function(a){return this.loadSuccess};APS.TextPropertiesManager=function(){};APS.TextPropertiesManager.prototype=new APS.PropertiesManager();APS.TextPropertiesManager.superclass=APS.PropertiesManager.prototype;APS.TextPropertiesManager.prototype.readFile=function(j,a,h,i){this.cb=a;this.ctx=h;this.rowSeparator=i;var g=document.getElementsByTagName("head");try{if(g[0]==undefined||g[0]==null){g[0]=document.createElement("head");var k=document.getElementsByTagName("html");k[0].appendChild(g[0])}}catch(b){}var d=g[0];var c=document.createElement("script");c.type="text/javascript";c.src=j;d.appendChild(c);var f=this;if(this.cb!=undefined&&this.cb!=null){c.onload=c.onreadystatechange=function(){this.complete=false;if(!this.complete&&(!this.readyState||this.readyState==="complete"||(this.readyState==="loaded"&&this.nextSibling!=null))){this.complete=true;if(!f.loadSuccess){f.cb.call(f.ctx,null,f.loadSuccess)}c.onload=c.onreadystatechange=null}else{if(this.readyState==="loaded"&&this.nextSibling==null){if(!f.loadSuccess){f.cb.call(f.ctx,null,f.loadSuccess)}}}};c.onerror=function(){if(!f.loadSuccess){f.cb.call(f.ctx,null,f.loadSuccess)}}}};APS.TextPropertiesManager.prototype.handleLoadComplete=function(){};APS.TextPropertiesManager.prototype.handleCB=function(a){if(a){this.parsePropertyFile(a)}else{this.done(null)}};APS.TextPropertiesManager.prototype.parsePropertyFile=function(a){var b=a.split(this.rowSeparator);this.done(b)};function trim(a){return a.replace(/^\s+|\s+$/g,"")}function ltrim(a){return a.replace(/^\s+/,"")}function rtrim(a){return a.replace(/\s+$/,"")}APS.PropertyReader=function(){this.cb;this.ctx;this.initialized=false;this._rawData;this.loadSuccess=false;this.tp=null};APS.PropertyReader.prototype.initialize=function(b,c,d,a){this.cb=c;this.ctx=d;this.tp=new APS.TextPropertiesManager(b,this.onDataReady,this,a);this.tp.readFile(b,this.onDataReady,this,a)};APS.PropertyReader.prototype.onDataReady=function(b,a){this.loadSuccess=a;if(a){if(b!=null){this._rawData=b;this.parseRawData()}else{this.done(a)}}else{this.done(a)}};APS.PropertyReader.prototype.done=function(a){if(this.ctx&&this.cb){this.cb.call(this.ctx,this,this.loadSuccess)}};APS.Deal=function(a,c){this.row=[];for(var b=0;b<a.length;b++){this.row[a[b]]=c[b]}};APS.Deal.prototype.getImage=function(){return this.row.imageurl};APS.Deal.prototype.getDescription=function(){return this.row.description};APS.Deal.prototype.getDealDesc=function(){return this.row.description};APS.Deal.prototype.getOriginalPrice=function(){return this.row.originalprice};APS.Deal.prototype.getListingPrice=function(){return this.row.discountedprice};APS.Deal.prototype.getDiscount=function(){return this.row.discountpercent};APS.Deal.prototype.getListingId=function(){return this.row.listingid};APS.Deal.prototype.getCategory=function(){return this.row.category};APS.Deal.prototype.getTitle=function(){return this.row.title};APS.Deal.prototype.getArea=function(){return this.row.area};APS.Deal.prototype.getVendor=function(){return this.row.vendor};APS.Deal.prototype.getProduct=function(){return this.row.product};APS.Deal.prototype.getBuyLink=function(){return this.row.landingurl};APS.Deal.prototype.getDealDates=function(){var a=new Object();a.sd=this.row.startdate;a.ed=this.row.enddate;return a};APS.Deal.prototype.getField=function(a){return this.row[a]};APS.Deal.prototype.setField=function(a,b){this.row[a]=b};APS.DealsReader=function(){this.classname="DealsReader";this._parsedData=new Array();this.currentRecordNum=0;this.headerList;this._dealsByArea=new Object();this._areaList=new Array()};APS.DealsReader.prototype=new APS.PropertyReader();APS.DealsReader.prototype.parseRawData=function(){this.headerList=this._rawData[0].split("\t");var f="";var e="";var c="";for(var d=1;d<this._rawData.length;d++){if(trim(this._rawData[d])!=""){var a=this._rawData[d].split("\t");var j=new APS.Deal(this.headerList,a);if(j.getField("log_data")!=null&&j.getField("log_data")!=""){f=j.getField("log_data")}else{j.setField("log_data",f)}if(j.getField("model")!=null&&j.getField("model")!=""){var h=j.getField("model").split(":");e=(h.length>1)?h[0]:h[0];j.setField("model",e)}else{j.setField("model",e)}if(j.getField("response_code")!=undefined&&j.getField("response_code")!=""){c=j.getField("response_code")}else{j.setField("response_code",c)}this._parsedData.push(j);var b=j.getArea();var g=this._dealsByArea[b];if(g==undefined||g==null){g=new Array();this._dealsByArea[b]=g;this._areaList.push(b)}g.push(j)}}this.initialized=true;this.done(this.initialized)};APS.DealsReader.prototype.getNext=function(a){if(!this.initialized){throw new Error("DealsReader not initialized")}this.currentRecordNum++;this.currentRecordNum=this.getBoundedIdx(a,this.currentRecordNum);var b=this.getCurrent(a);return b};APS.DealsReader.prototype.getCurrent=function(a){var b;b=(a!=null)?this._dealsByArea[a][this.currentRecordNum]:this._parsedData[this.currentRecordNum];return b};APS.DealsReader.prototype.getPrevious=function(a){if(!this.initialized){throw new Error("DealsReader not initialized")}this.currentRecordNum--;this.currentRecordNum=this.getBoundedIdx(a,this.currentRecordNum);var b=this.getCurrent(a);return b};APS.DealsReader.prototype.resetRecordNum=function(){this.currentRecordNum=0};APS.DealsReader.prototype.lookupNext=function(c){if(!this.initialized){throw new Error("DealsReader not initialized")}var b=this.currentRecordNum+1;var a;b=this.getBoundedIdx(c,this.currentRecordNum);a=(c!=null)?this._dealsByArea[c][b]:this._parsedData[b];return a};APS.DealsReader.prototype.getAreaList=function(){return this._areaList};APS.DealsReader.prototype.randomize=function(b){var a;a=(b!=null)?this._dealsByArea[b].length:this._parsedData.length;this.currentRecordNum=this.getBoundedIdx(b,Math.floor(Math.random()*a))};APS.DealsReader.prototype.getBoundedIdx=function(a,c){var b;b=(a!=null)?this._dealsByArea[a].length:this._parsedData.length;return(c>=b?0:(c<0?b-1:c))};APS.DealsReader.prototype.getNumDeals=function(a,c){var b;b=(a!=null)?this._dealsByArea[a].length:this._parsedData.length;return b};function cb(d){var g="default";if(d!=undefined&&d!=null){var i=d.split("");if(i.length>0){var f=i[0].split("\t");var h=i[1].split("\t");var b=new APS.Deal(f,h);if(b!=undefined&&b!=null){var e=b.getField("partner");if(e!=undefined&&e!=null){g=e}else{var c=b.getImage();if(c!=undefined&&c!=null){g=c.split("/")[5]}}}}}var a=APS.PropertyReaderFactory.getInstance(APS.PropertyReaderFactory.DEALS_READER,null,null,null,g);if(a!=undefined&&a!=null){if(a.tp!=null){a.tp.setLoadSuccess.call(a.tp,true);a.tp.handleCB.call(a.tp,d,true)}}}APS.SocadConfPropertyReader=function(){this.classname="SocadConfPropertyReader";this._parsedData=new Object()};APS.SocadConfPropertyReader.prototype=new APS.PropertyReader();APS.SocadConfPropertyReader.prototype.parseRawData=function(){for(var a=0;a<this._rawData.length;a++){if(this._rawData[a]!=""){var b=trim(this._rawData[a]);var c=b.split("=");var d=c[0];var e=(c.length>1)?c[1]:"";if(d.charAt(0)!="#"&&d.length>0){this._parsedData[d]=e}}}this.initialized=true};APS.SocadConfPropertyReader.prototype.get=function(a){if(!this.initialized){throw new Error("SocadConfPropertyReader not initialized")}var b=this._parsedData[a];return this._parsedData[a]};var pr=[];APS.PropertyReaderFactory=function(){};APS.PropertyReaderFactory.SOCAD_CONFIG_READER=1;APS.PropertyReaderFactory.DEALS_READER=2;pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER]=[];pr[APS.PropertyReaderFactory.DEALS_READER]=[];APS.PropertyReaderFactory.getInstance=function(b,a,e,f,c){if(c==undefined||c==null){c="default"}if(b==APS.PropertyReaderFactory.SOCAD_CONFIG_READER){if(pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER][c]!=undefined&&pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER][c]!=null){return pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER][c]}else{var d=new APS.SocadConfPropertyReader();pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER][c]=d;if(a!=undefined&&a!=null){d.initialize.call(d,a,e,f,";")}return pr[APS.PropertyReaderFactory.SOCAD_CONFIG_READER][c]}}else{if(b==APS.PropertyReaderFactory.DEALS_READER){if(pr[APS.PropertyReaderFactory.DEALS_READER][c]!=undefined&&pr[APS.PropertyReaderFactory.DEALS_READER][c]!=null){return pr[APS.PropertyReaderFactory.DEALS_READER][c]}else{var d=new APS.DealsReader();pr[APS.PropertyReaderFactory.DEALS_READER][c]=d;if(a!=undefined&&a!=null){d.initialize.call(d,a,e,f,"")}return pr[APS.PropertyReaderFactory.DEALS_READER][c]}}}};